<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-going-further/other-notes">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/ransack/blog/rss.xml" title="Ransack documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ransack/blog/atom.xml" title="Ransack documentation Atom Feed"><title data-rh="true">Other notes | Ransack documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://activerecord-hackery.github.io/ransack/going-further/other-notes"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Other notes | Ransack documentation"><meta data-rh="true" name="description" content="Ransack Aliases"><meta data-rh="true" property="og:description" content="Ransack Aliases"><link data-rh="true" rel="icon" href="/ransack/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://activerecord-hackery.github.io/ransack/going-further/other-notes"><link data-rh="true" rel="alternate" href="https://activerecord-hackery.github.io/ransack/going-further/other-notes" hreflang="en"><link data-rh="true" rel="alternate" href="https://activerecord-hackery.github.io/ransack/going-further/other-notes" hreflang="x-default"><link rel="stylesheet" href="/ransack/assets/css/styles.03efa0bd.css">
<link rel="preload" href="/ransack/assets/js/runtime~main.ea950ceb.js" as="script">
<link rel="preload" href="/ransack/assets/js/main.deaad47f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ransack/"><div class="navbar__logo"><img src="/ransack/./logo/ransack-h.png" alt="Ransack Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/ransack/./logo/ransack-h.png" alt="Ransack Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a><a class="navbar__item navbar__link navbar__link--active" href="/ransack/">Documentation</a><a class="navbar__item navbar__link" href="/ransack/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/activerecord-hackery/ransack" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ransack/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ransack/getting-started/simple-mode">Getting started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/ransack/going-further/associations">Going further</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/associations">Associations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/custom-predicates">Custom predicates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/exporting-to-csv">CSV Export</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/i18n">i18n</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/form-customisation">Form customisation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/merging-searches">Merging searches</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/ransackers">Ransackers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/saving-queries">Saving queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ransack/going-further/other-notes">Other notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/searching-postgres">Postgres searches</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/external-guides">External resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/documentation">Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/release_process">Versions and Releases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ransack/going-further/wiki-contributors">Wiki Contributors</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/ransack/">🏠</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Going further</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Other notes</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Other notes</h1></header><h3 class="anchor anchorWithStickyNavbar_mojV" id="ransack-aliases">Ransack Aliases<a class="hash-link" href="#ransack-aliases" title="Direct link to heading">​</a></h3><p>You can customize the attribute names for your Ransack searches by using a
<code>ransack_alias</code>. This is particularly useful for long attribute names that are
necessary when querying associations or multiple columns.</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class Post &lt; ActiveRecord::Base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  belongs_to :author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Abbreviate :author_first_name_or_author_last_name to :author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ransack_alias :author, :author_first_name_or_author_last_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Now, rather than using <code>:author_first_name_or_author_last_name_cont</code> in your
form, you can simply use <code>:author_cont</code>. This serves to produce more expressive
query parameters in your URLs.</p><div class="codeBlockContainer_I0IT language-erb theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-erb codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;%= search_form_for @q do |f| %&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;%= f.label :author_cont %&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;%= f.search_field :author_cont %&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;% end %&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>You can also use <code>ransack_alias</code> for sorting.</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class Post &lt; ActiveRecord::Base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  belongs_to :author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Abbreviate :author_first_name to :author</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ransack_alias :author, :author_first_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Now, you can use <code>:author</code> instead of <code>:author_first_name</code> in a <code>sort_link</code>.</p><div class="codeBlockContainer_I0IT language-erb theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-erb codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;%= sort_link(@q, :author) %&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Note that using <code>:author_first_name_or_author_last_name_cont</code> would produce an invalid sql query. In those cases, Ransack ignores the sorting clause.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="problem-with-distinct-selects">Problem with DISTINCT selects<a class="hash-link" href="#problem-with-distinct-selects" title="Direct link to heading">​</a></h3><p>If passed <code>distinct: true</code>, <code>result</code> will generate a <code>SELECT DISTINCT</code> to
avoid returning duplicate rows, even if conditions on a join would otherwise
result in some. It generates the same SQL as calling <code>uniq</code> on the relation.</p><p>Please note that for many databases, a sort on an associated table&#x27;s columns
may result in invalid SQL with <code>distinct: true</code> -- in those cases, you
will need to modify the result as needed to allow these queries to work.</p><p>For example, you could call joins and includes on the result which has the
effect of adding those tables columns to the select statement, overcoming
the issue, like so:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @q = Person.ransack(params[:q])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @people = @q.result(distinct: true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              .includes(:articles)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              .joins(:articles)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              .page(params[:page])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>If the above doesn&#x27;t help, you can also use ActiveRecord&#x27;s <code>select</code> query
to explicitly add the columns you need, which brute force&#x27;s adding the
columns you need that your SQL engine is complaining about, you need to
make sure you give all of the columns you care about, for example:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @q = Person.ransack(params[:q])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @people = @q.result(distinct: true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              .select(&#x27;people.*, articles.name, articles.description&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              .page(params[:page])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Another method to approach this when using Postgresql is to use ActiveRecords&#x27;s <code>.includes</code> in combination with <code>.group</code> instead of <code>distinct: true</code>.</p><p>For example:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @q = Person.ransack(params[:q])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @people = @q.result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              .group(&#x27;persons.id&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              .includes(:articles)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              .page(params[:page])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>A final way of last resort is to call <code>to_a.uniq</code> on the collection at the end
with the caveat that the de-duping is taking place in Ruby instead of in SQL,
which is potentially slower and uses more memory, and that it may display
awkwardly with pagination if the number of results is greater than the page size.</p><p>For example:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @q = Person.ransack(params[:q])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @people = @q.result.includes(:articles).page(params[:page]).to_a.uniq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="pgundefinedfunction-error-could-not-identify-an-equality-operator-for-type-json"><code>PG::UndefinedFunction: ERROR: could not identify an equality operator for type json</code><a class="hash-link" href="#pgundefinedfunction-error-could-not-identify-an-equality-operator-for-type-json" title="Direct link to heading">​</a></h4><p>If you get the above error while using <code>distinct: true</code> that means that
one of the columns that Ransack is selecting is a <code>json</code> column.
PostgreSQL does not provide comparison operators for the <code>json</code> type.  While
it is possible to work around this, in practice it&#x27;s much better to convert those
to <code>jsonb</code>, as <a href="https://www.postgresql.org/docs/9.6/static/datatype-json.html" target="_blank" rel="noopener noreferrer">recommended by the PostgreSQL documentation</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="authorization-allowlistingdenylisting">Authorization (allowlisting/denylisting)<a class="hash-link" href="#authorization-allowlistingdenylisting" title="Direct link to heading">​</a></h3><p>By default, searching and sorting are authorized on any column of your model
and no class methods/scopes are whitelisted.</p><p>Ransack adds four methods to <code>ActiveRecord::Base</code> that you can redefine as
class methods in your models to apply selective authorization:</p><ul><li><code>ransackable_attributes</code></li><li><code>ransackable_associations</code></li><li><code>ransackable_scopes</code></li><li><code>ransortable_attributes</code></li></ul><p>Here is how these four methods are implemented in Ransack:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  # `ransackable_attributes` by default returns all column names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # and any defined ransackers as an array of strings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # For overriding with a whitelist array of strings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def ransackable_attributes(auth_object = nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    column_names + _ransackers.keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # `ransackable_associations` by default returns the names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # of all associations as an array of strings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # For overriding with a whitelist array of strings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def ransackable_associations(auth_object = nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reflect_on_all_associations.map { |a| a.name.to_s }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # `ransortable_attributes` by default returns the names</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # of all attributes available for sorting as an array of strings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # For overriding with a whitelist array of strings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def ransortable_attributes(auth_object = nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ransackable_attributes(auth_object)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # `ransackable_scopes` by default returns an empty array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # i.e. no class methods/scopes are authorized.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # For overriding with a whitelist array of *symbols*.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def ransackable_scopes(auth_object = nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Any values not returned from these methods will be ignored by Ransack, i.e.
they are not authorized.</p><p>All four methods can receive a single optional parameter, <code>auth_object</code>. When
you call the search or ransack method on your model, you can provide a value
for an <code>auth_object</code> key in the options hash which can be used by your own
overridden methods.</p><p>Here is an example that puts all this together, adapted from
<a href="http://erniemiller.org/2012/05/11/why-your-ruby-class-macros-might-suck-mine-did/" target="_blank" rel="noopener noreferrer">this blog post by Ernie Miller</a>.
In an <code>Article</code> model, add the following <code>ransackable_attributes</code> class method
(preferably private):</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class Article &lt; ActiveRecord::Base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def self.ransackable_attributes(auth_object = nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if auth_object == :admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # whitelist all attributes for admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      super</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # whitelist only the title and body attributes for other users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      super &amp; %w(title body)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private_class_method :ransackable_attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Here is example code for the <code>articles_controller</code>:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class ArticlesController &lt; ApplicationController</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @q = Article.ransack(params[:q], auth_object: set_ransack_auth_object)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @articles = @q.result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  private</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def set_ransack_auth_object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    current_user.admin? ? :admin : nil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Trying it out in <code>rails console</code>:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Article</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; Article(id: integer, person_id: integer, title: string, body: text)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Article.ransackable_attributes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; [&quot;title&quot;, &quot;body&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Article.ransackable_attributes(:admin)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; [&quot;id&quot;, &quot;person_id&quot;, &quot;title&quot;, &quot;body&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Article.ransack(id_eq: 1).result.to_sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; SELECT &quot;articles&quot;.* FROM &quot;articles&quot;  # Note that search param was ignored!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Article.ransack({ id_eq: 1 }, { auth_object: nil }).result.to_sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; SELECT &quot;articles&quot;.* FROM &quot;articles&quot;  # Search param still ignored!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; Article.ransack({ id_eq: 1 }, { auth_object: :admin }).result.to_sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; SELECT &quot;articles&quot;.* FROM &quot;articles&quot;  WHERE &quot;articles&quot;.&quot;id&quot; = 1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>That&#x27;s it! Now you know how to whitelist/blacklist various elements in Ransack.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="handling-unknown-predicates-or-attributes">Handling unknown predicates or attributes<a class="hash-link" href="#handling-unknown-predicates-or-attributes" title="Direct link to heading">​</a></h3><p>By default, Ransack will ignore any unknown predicates or attributes:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Article.ransack(unknown_attr_eq: &#x27;Ernie&#x27;).result.to_sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; SELECT &quot;articles&quot;.* FROM &quot;articles&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Ransack may be configured to raise an error if passed an unknown predicate or
attributes, by setting the <code>ignore_unknown_conditions</code> option to <code>false</code> in your
Ransack initializer file at <code>config/initializers/ransack.rb</code>:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Ransack.configure do |c|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Raise errors if a query contains an unknown predicate or attribute.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Default is true (do not raise error on unknown conditions).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  c.ignore_unknown_conditions = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Article.ransack(unknown_attr_eq: &#x27;Ernie&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ArgumentError (Invalid search term unknown_attr_eq)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>As an alternative to setting a global configuration option, the <code>.ransack!</code>
class method also raises an error if passed an unknown condition:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Article.ransack!(unknown_attr_eq: &#x27;Ernie&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ArgumentError: Invalid search term unknown_attr_eq</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>This is equivalent to the <code>ignore_unknown_conditions</code> configuration option,
except it may be applied on a case-by-case basis.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="using-scopesclass-methods">Using Scopes/Class Methods<a class="hash-link" href="#using-scopesclass-methods" title="Direct link to heading">​</a></h3><p>Continuing on from the preceding section, searching by scopes requires defining
a whitelist of <code>ransackable_scopes</code> on the model class. The whitelist should be
an array of <em>symbols</em>. By default, all class methods (e.g. scopes) are ignored.
Scopes will be applied for matching <code>true</code> values, or for given values if the
scope accepts a value:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class Employee &lt; ActiveRecord::Base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scope :activated, -&gt;(boolean = true) { where(active: boolean) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scope :salary_gt, -&gt;(amount) { where(&#x27;salary &gt; ?&#x27;, amount) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Scopes are just syntactical sugar for class methods, which may also be used:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def self.hired_since(date)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    where(&#x27;start_date &gt;= ?&#x27;, date)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  def self.ransackable_scopes(auth_object = nil)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if auth_object.try(:admin?)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # allow admin users access to all three methods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      %i(activated hired_since salary_gt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # allow other users to search on `activated` and `hired_since` only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      %i(activated hired_since)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Employee.ransack({ activated: true, hired_since: &#x27;2013-01-01&#x27; })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Employee.ransack({ salary_gt: 100_000 }, { auth_object: current_user })</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>In Rails 3 and 4, if the <code>true</code> value is being passed via url params or some
other mechanism that will convert it to a string, the true value may not be
passed to the ransackable scope unless you wrap it in an array
(i.e. <code>activated: [&#x27;true&#x27;]</code>). Ransack will take care of changing &#x27;true&#x27; into a
boolean. This is currently resolved in Rails 5 😃</p><p>However, perhaps you have <code>user_id: [1]</code> and you do not want Ransack to convert
1 into a boolean. (Values sanitized to booleans can be found in the
<a href="https://github.com/activerecord-hackery/ransack/blob/master/lib/ransack/constants.rb#L28" target="_blank" rel="noopener noreferrer">constants.rb</a>).
To turn this off globally, and handle type conversions yourself, set
<code>sanitize_custom_scope_booleans</code> to false in an initializer file like
config/initializers/ransack.rb:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Ransack.configure do |c|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  c.sanitize_custom_scope_booleans = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>To turn this off on a per-scope basis Ransack adds the following method to
<code>ActiveRecord::Base</code> that you can redefine to selectively override sanitization:</p><p><code>ransackable_scopes_skip_sanitize_args</code></p><p>Add the scope you wish to bypass this behavior to ransackable_scopes_skip_sanitize_args:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def self.ransackable_scopes_skip_sanitize_args</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [:scope_to_skip_sanitize_args]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Scopes are a recent addition to Ransack and currently have a few caveats:
First, a scope involving child associations needs to be defined in the parent
table model, not in the child model. Second, scopes with an array as an
argument are not easily usable yet, because the array currently needs to be
wrapped in an array to function (see
<a href="https://github.com/activerecord-hackery/ransack/issues/404" target="_blank" rel="noopener noreferrer">this issue</a>),
which is not compatible with Ransack form helpers. For this use case, it may be
better for now to use <a href="https://github.com/activerecord-hackery/ransack/wiki/Using-Ransackers" target="_blank" rel="noopener noreferrer">ransackers</a> instead,
where feasible. Pull requests with solutions and tests are welcome!</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="grouping-queries-by-or-instead-of-and">Grouping queries by OR instead of AND<a class="hash-link" href="#grouping-queries-by-or-instead-of-and" title="Direct link to heading">​</a></h3><p>The default <code>AND</code> grouping can be changed to <code>OR</code> by adding <code>m: &#x27;or&#x27;</code> to the
query hash.</p><p>You can easily try it in your controller code by changing <code>params[:q]</code> in the
<code>index</code> action to <code>params[:q].try(:merge, m: &#x27;or&#x27;)</code> as follows:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @q = Artist.ransack(params[:q].try(:merge, m: &#x27;or&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @artists = @q.result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Normally, if you wanted users to be able to toggle between <code>AND</code> and <code>OR</code>
query grouping, you would probably set up your search form so that <code>m</code> was in
the URL params hash, but here we assigned <code>m</code> manually just to try it out
quickly.</p><p>Alternatively, trying it in the Rails console:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">artists = Artist.ransack(name_cont: &#x27;foo&#x27;, style_cont: &#x27;bar&#x27;, m: &#x27;or&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; Ransack::Search&lt;class: Artist, base: Grouping &lt;conditions: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Condition &lt;attributes: [&quot;name&quot;], predicate: cont, values: [&quot;foo&quot;]&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Condition &lt;attributes: [&quot;style&quot;], predicate: cont, values: [&quot;bar&quot;]&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ], combinator: or&gt;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">artists.result.to_sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; &quot;SELECT \&quot;artists\&quot;.* FROM \&quot;artists\&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WHERE ((\&quot;artists\&quot;.\&quot;name\&quot; ILIKE &#x27;%foo%&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OR \&quot;artists\&quot;.\&quot;style\&quot; ILIKE &#x27;%bar%&#x27;))&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>The combinator becomes <code>or</code> instead of the default <code>and</code>, and the SQL query
becomes <code>WHERE...OR</code> instead of <code>WHERE...AND</code>.</p><p>This works with associations as well. Imagine an Artist model that has many
Memberships, and many Musicians through Memberships:</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">artists = Artist.ransack(name_cont: &#x27;foo&#x27;, musicians_email_cont: &#x27;bar&#x27;, m: &#x27;or&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; Ransack::Search&lt;class: Artist, base: Grouping &lt;conditions: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Condition &lt;attributes: [&quot;name&quot;], predicate: cont, values: [&quot;foo&quot;]&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Condition &lt;attributes: [&quot;musicians_email&quot;], predicate: cont, values: [&quot;bar&quot;]&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ], combinator: or&gt;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">artists.result.to_sql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt; &quot;SELECT \&quot;artists\&quot;.* FROM \&quot;artists\&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LEFT OUTER JOIN \&quot;memberships\&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ON \&quot;memberships\&quot;.\&quot;artist_id\&quot; = \&quot;artists\&quot;.\&quot;id\&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LEFT OUTER JOIN \&quot;musicians\&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ON \&quot;musicians\&quot;.\&quot;id\&quot; = \&quot;memberships\&quot;.\&quot;musician_id\&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WHERE ((\&quot;artists\&quot;.\&quot;name\&quot; ILIKE &#x27;%foo%&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OR \&quot;musicians\&quot;.\&quot;email\&quot; ILIKE &#x27;%bar%&#x27;))&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="using-simpleform">Using SimpleForm<a class="hash-link" href="#using-simpleform" title="Direct link to heading">​</a></h3><p>If you would like to combine the Ransack and SimpleForm form builders, set the
<code>RANSACK_FORM_BUILDER</code> environment variable before Rails boots up, e.g. in
<code>config/application.rb</code> before <code>require &#x27;rails/all&#x27;</code> as shown below (and add
<code>gem &#x27;simple_form&#x27;</code> in your Gemfile).</p><div class="codeBlockContainer_I0IT language-ruby theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-ruby codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">require File.expand_path(&#x27;../boot&#x27;, __FILE__)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV[&#x27;RANSACK_FORM_BUILDER&#x27;] = &#x27;::SimpleForm::FormBuilder&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">require &#x27;rails/all&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/activerecord-hackery/ransack/docs/docs/docs/going-further/other-notes.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ransack/going-further/saving-queries"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Saving queries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ransack/going-further/searching-postgres"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Postgres searches</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ransack-aliases" class="table-of-contents__link toc-highlight">Ransack Aliases</a></li><li><a href="#problem-with-distinct-selects" class="table-of-contents__link toc-highlight">Problem with DISTINCT selects</a></li><li><a href="#authorization-allowlistingdenylisting" class="table-of-contents__link toc-highlight">Authorization (allowlisting/denylisting)</a></li><li><a href="#handling-unknown-predicates-or-attributes" class="table-of-contents__link toc-highlight">Handling unknown predicates or attributes</a></li><li><a href="#using-scopesclass-methods" class="table-of-contents__link toc-highlight">Using Scopes/Class Methods</a></li><li><a href="#grouping-queries-by-or-instead-of-and" class="table-of-contents__link toc-highlight">Grouping queries by OR instead of AND</a></li><li><a href="#using-simpleform" class="table-of-contents__link toc-highlight">Using SimpleForm</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/ransack/">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/ransack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/ransack/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/activerecord-hackery/ransack" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/ransack/assets/js/runtime~main.ea950ceb.js"></script>
<script src="/ransack/assets/js/main.deaad47f.js"></script>
</body>
</html>